<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Bueno, leyendo el siguiente tema de @macadamQuejoso , se me ocurrio crear un sistema de mensajeria hecho en POO ( programacion orientada a objetos) para ir practicando un poco esto de POO, incluye lo escencial.
primero tienen que crear una tabla con el nombre que quieran, pero de la siguiente manera
`ID` int(11) NOT NULL AUTO_INCREMENT, `from` varchar(32) NOT NULL, `to` varchar(32) NOT NULL, `subject` text NOT NULL, `body` text NOT NULL, `isread` tinyint(1) NOT NULL, `deletefrom` tinyint(1) NOT NULL, `deleteto` tinyint(1) NOT NULL, PRIMARY KEY (`ID`) antes de usar el sistema tienen que conectar y seleccionar la base de mysql asi" />
    <meta property="og:site_name" content="Federico Scodelaro" />
    <meta property="og:title" content="[Aporte][PHP][Class] Sistema de mensajeria para tu sitio | Federico Scodelaro"/>
    <meta property="og:description" content="Bueno, leyendo el siguiente tema de @macadamQuejoso , se me ocurrio crear un sistema de mensajeria hecho en POO ( programacion orientada a objetos) para ir practicando un poco esto de POO, incluye lo escencial.
primero tienen que crear una tabla con el nombre que quieran, pero de la siguiente manera
`ID` int(11) NOT NULL AUTO_INCREMENT, `from` varchar(32) NOT NULL, `to` varchar(32) NOT NULL, `subject` text NOT NULL, `body` text NOT NULL, `isread` tinyint(1) NOT NULL, `deletefrom` tinyint(1) NOT NULL, `deleteto` tinyint(1) NOT NULL, PRIMARY KEY (`ID`) antes de usar el sistema tienen que conectar y seleccionar la base de mysql asi" />
    <meta property="og:image" content="https://pudymody.github.io/static/me.jpg" />
    <meta property="og:url" content="https://pudymody.github.io/taringa/aporte-php-class-sistema-de-mensajeria-para-tu-sitio/" >
    <meta property="og:type" content="blog" />
    
      <meta property="article:published_time" content="2011-04-29 00:00:00 &#43;0000 UTC">
    
    <title>[Aporte][PHP][Class] Sistema de mensajeria para tu sitio | Federico Scodelaro</title>
    <link rel="stylesheet" href="https://pudymody.github.io/static/tufte.min.css" />
    <link rel="shortcut icon" href="https://pudymody.github.io/static/favicon.png" type="image/png">
    <link rel="alternate" type="application/rss+xml" title="RSS" href="https://pudymody.github.io/index.xml">
  </head>

  <body>
    <header>
      <nav>
        <ul>
          
          
          <li>
            <a href="https://pudymody.github.io/">/home/federico scodelaro</a>
          </li>
          -
          <li>
            <a target="_blank" rel="noopener" href="https://github.com/pudymody">Github</a>
          </li>
          -
          <li>
            <a target="_blank" rel="noopener" href="https://telegram.me/pudymody">Telegram</a>
          </li>
          -
          <li>
            <a target="_blank" rel="noopener" href="mailto:federicoscodelaro@gmail.com">Email</a>
          </li>
          -
          

          
          
          <li>
            <a href="/index.xml">~/subscribe</a>
          </li>
          
        </ul>
      </nav>
    </header>
    <article>

<section>
<h1>[Aporte][PHP][Class] Sistema de mensajeria para tu sitio</h1>
<p class="subtitle">2011/04/29</p>



<p>Bueno, leyendo el siguiente <a href="http://www.taringa.net/comunidades/webdesign/2570503/%255BConsulta+PHP%255D+Mensajer%25C3%25ADa+interna%253A+usuario+elimina+sus+mp.html">tema</a> de <a href="https://www.taringa.net/macadamQuejoso">@macadamQuejoso</a> , se me ocurrio crear un sistema de mensajeria hecho en POO ( programacion orientada a objetos) para ir practicando un poco esto de POO, incluye lo escencial.</p>

<p>primero tienen que crear una tabla con el nombre que quieran, pero de la siguiente manera</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">`ID` int(11) <span style="color:#00f">NOT</span> <span style="color:#00f">NULL</span> AUTO_INCREMENT,
`<span style="color:#00f">from</span>` varchar(32) <span style="color:#00f">NOT</span> <span style="color:#00f">NULL</span>,
`<span style="color:#00f">to</span>` varchar(32) <span style="color:#00f">NOT</span> <span style="color:#00f">NULL</span>,
`subject` text <span style="color:#00f">NOT</span> <span style="color:#00f">NULL</span>,
`body` text <span style="color:#00f">NOT</span> <span style="color:#00f">NULL</span>,
`isread` tinyint(1) <span style="color:#00f">NOT</span> <span style="color:#00f">NULL</span>,
`deletefrom` tinyint(1) <span style="color:#00f">NOT</span> <span style="color:#00f">NULL</span>,
`deleteto` tinyint(1) <span style="color:#00f">NOT</span> <span style="color:#00f">NULL</span>,
<span style="color:#00f">PRIMARY</span> <span style="color:#00f">KEY</span> (`ID`)</code></pre></div>
<p>antes de usar el sistema tienen que conectar y seleccionar la base de mysql asi</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#00f">&lt;?php</span>
mysql_connect(<span style="color:#a31515">&#39;SERVER&#39;</span>,<span style="color:#a31515">&#39;USER&#39;</span>,<span style="color:#a31515">&#39;PASS&#39;</span>);
mysql_select_db(<span style="color:#a31515">&#39;BASE&#39;</span>);
<span style="color:#00f">?&gt;</span>
</code></pre></div>
<p>Ahora la clase que deben utilizar, la documente toda en el codigo asi que no voy a dar explicaciones aca..</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#00f">&lt;?php</span>
<span style="color:#00f">class</span> <span style="color:#2b91af">mensajeria</span>{
    <span style="color:#008000">//creamos una variable privada donde almacenaremos el nombre de la tabla donde se almacenan los mensajes
</span><span style="color:#008000"></span>    <span style="color:#00f">private</span> $tabla;
    
    <span style="color:#008000">//al crear la clase pasamos como parametro el nombre de la base, si esta vacio doy un mensaje de error,si no lo almaceno en la variable privada $tabla
</span><span style="color:#008000"></span>    <span style="color:#00f">public</span> <span style="color:#00f">function</span> __construct($base){
        <span style="color:#00f">if</span>(<span style="color:#00f">empty</span>($base)){
            <span style="color:#00f">die</span>(<span style="color:#a31515">&#39;Debe Seleccionar Una Base Para Poder Iniciar El Sistema De Mensajeria&#39;</span>);
        }<span style="color:#00f">else</span>{
            $this-&gt;tabla = $base;
        }
    }

    <span style="color:#008000">//pasamos como parametros el nombre del usuario que envia,a quien,el asunto y el mensaje para luego insertarlo en la tabla.
</span><span style="color:#008000"></span>    <span style="color:#008000">//el parametro isread establece si el mensaje esta leido o no.
</span><span style="color:#008000"></span>    <span style="color:#008000">//deletefrom define si el mensaje es borrado de la bandeja de salida (autor)
</span><span style="color:#008000"></span>    <span style="color:#008000">//deleteto define si el mensaje es borrado de la bandeja de entrada (receptor)
</span><span style="color:#008000"></span>    <span style="color:#00f">public</span> <span style="color:#00f">function</span> enviar($de,$para,$asunto,$mensaje){
        $enviar = mysql_query(<span style="color:#a31515">&#34;INSERT INTO </span><span style="color:#a31515">$this-&gt;tabla</span><span style="color:#a31515"> (de,para,subject,body,isread,deletefrom,deleteto) VALUES (&#39;</span><span style="color:#a31515">$de</span><span style="color:#a31515">&#39;,&#39;</span><span style="color:#a31515">$para</span><span style="color:#a31515">&#39;,&#39;</span><span style="color:#a31515">$asunto</span><span style="color:#a31515">&#39;,&#39;</span><span style="color:#a31515">$mensaje</span><span style="color:#a31515">&#39;,0,0,0)&#34;</span>);
        <span style="color:#00f">if</span>($enviar){
            <span style="color:#00f">return</span> <span style="color:#00f">true</span>;
        }<span style="color:#00f">else</span>{
            <span style="color:#00f">return</span> <span style="color:#00f">false</span>;
        }
    }
    
    <span style="color:#008000">//pasamos como parametro el nombre del usuario, para luego de hacer una consulta a la tabla, recorrer con un bucle el resultado, almacenar en un array todos los datos.
</span><span style="color:#008000"></span>    <span style="color:#008000">//devuelve un array similar a este
</span><span style="color:#008000"></span>    <span style="color:#008000">//Array ( [0] =&gt; Array ( [ID] =&gt; 12 [From] =&gt; DE QUIEN [Subject] =&gt; ASUNTO [IsRead] =&gt; 0 SI NO ESTA LEIDO,EN CASO CONTRARIO 1 ) ) 
</span><span style="color:#008000"></span>    <span style="color:#00f">public</span>    <span style="color:#00f">function</span> obtenerrecibidos ($user){
        <span style="color:#00f">if</span>(<span style="color:#00f">empty</span>($user)){
            <span style="color:#00f">die</span>(<span style="color:#a31515">&#39;Debe Pasar Como Parametro Un Usuario Del Cual Obtener Los Mensajes&#39;</span>);
        }<span style="color:#00f">else</span>{
            $recibidos = mysql_query(<span style="color:#a31515">&#34;SELECT ID,de,subject,isread FROM </span><span style="color:#a31515">$this-&gt;tabla</span><span style="color:#a31515"> WHERE para = &#39;</span><span style="color:#a31515">$user</span><span style="color:#a31515">&#39; AND deleteto = 0&#34;</span>);
            <span style="color:#00f">if</span>(mysql_num_rows($recibidos) &gt; 0){
                <span style="color:#00f">while</span> ($r = mysql_fetch_assoc($recibidos)){
                    $mensajes[] = <span style="color:#00f">array</span>(
                        <span style="color:#a31515">&#39;ID&#39;</span>=&gt;$r[<span style="color:#a31515">&#39;ID&#39;</span>],
                        <span style="color:#a31515">&#39;From&#39;</span>=&gt;$r[<span style="color:#a31515">&#39;de&#39;</span>],
                        <span style="color:#a31515">&#39;Subject&#39;</span>=&gt;$r[<span style="color:#a31515">&#39;subject&#39;</span>],
                        <span style="color:#a31515">&#39;IsRead&#39;</span>=&gt;$r[<span style="color:#a31515">&#39;isread&#39;</span>],
                    );
                }
                <span style="color:#00f">return</span> $mensajes;
            }<span style="color:#00f">else</span>{
                <span style="color:#00f">return</span> <span style="color:#a31515">&#39;No Tienes Ningun Mensaje&#39;</span>;
            }
        }
    }
    
    <span style="color:#008000">//esta funcion es exactamente igual a la anterior, solo que obtiene los mensajes enviados, devolviendo un array similar a este
</span><span style="color:#008000"></span>    <span style="color:#008000">//Array ( [0] =&gt; Array ( [ID] =&gt; 12 [To] =&gt; A QUIEN [Subject] =&gt; ASUNTO) ) 
</span><span style="color:#008000"></span>    <span style="color:#00f">public</span> <span style="color:#00f">function</span> obtenerenviados ($user){
        <span style="color:#00f">if</span>(<span style="color:#00f">empty</span>($user)){
            <span style="color:#00f">die</span>(<span style="color:#a31515">&#39;Debe Pasar Como Parametro Un Usuario Del Cual Obtener Los Mensajes&#39;</span>);
        }<span style="color:#00f">else</span>{
            $recibidos = mysql_query(<span style="color:#a31515">&#34;SELECT ID,para,subject FROM </span><span style="color:#a31515">$this-&gt;tabla</span><span style="color:#a31515"> WHERE de = &#39;</span><span style="color:#a31515">$user</span><span style="color:#a31515">&#39; AND deletefrom = 0&#34;</span>);
            <span style="color:#00f">if</span>(mysql_num_rows($recibidos) &gt; 0){
                <span style="color:#00f">while</span> ($r = mysql_fetch_assoc($recibidos)){
                    $mensajes[] = <span style="color:#00f">array</span>(
                        <span style="color:#a31515">&#39;ID&#39;</span>=&gt;$r[<span style="color:#a31515">&#39;ID&#39;</span>],
                        <span style="color:#a31515">&#39;To&#39;</span>=&gt;$r[<span style="color:#a31515">&#39;para&#39;</span>],
                        <span style="color:#a31515">&#39;Subject&#39;</span>=&gt;$r[<span style="color:#a31515">&#39;subject&#39;</span>],
                    );
                }
                <span style="color:#00f">return</span> $mensajes;
            }<span style="color:#00f">else</span>{
                <span style="color:#00f">return</span> <span style="color:#a31515">&#39;No Enviaste Ningun Mensaje&#39;</span>;
            }
        }
    }
    
    <span style="color:#008000">//pasamos como parametro el id del mensaje, para luego de hacer la consulta a la tabla, devolver un array con todos los datos similar a este
</span><span style="color:#008000"></span>    <span style="color:#008000">//Array ( [0] =&gt; Array ( [From] =&gt; DE QUIEN [Subject] =&gt; ASUNTO [Body] =&gt; MENSAJE) ) 
</span><span style="color:#008000"></span>    <span style="color:#00f">public</span> <span style="color:#00f">function</span> ver($id){
        <span style="color:#00f">if</span>(<span style="color:#00f">empty</span>($id)){
            <span style="color:#00f">return</span> <span style="color:#a31515">&#39;Debe Pasar Como Parametro Un ID De Mensaje Para Ver&#39;</span>;
        }<span style="color:#00f">else</span>{
            $ver = mysql_query(<span style="color:#a31515">&#34;SELECT de,subject,body FROM mensajes&#34;</span>);
            <span style="color:#00f">while</span> ($r = mysql_fetch_assoc($ver)){
                $datosmensaje = <span style="color:#00f">array</span>(
                    <span style="color:#a31515">&#39;From&#39;</span>=&gt; $r[<span style="color:#a31515">&#39;de&#39;</span>],
                    <span style="color:#a31515">&#39;Subject&#39;</span>=&gt; $r[<span style="color:#a31515">&#39;subject&#39;</span>],
                    <span style="color:#a31515">&#39;Body&#39;</span>=&gt; $r[<span style="color:#a31515">&#39;body&#39;</span>],
                );
            }
            $marcarleido = mysql_query(<span style="color:#a31515">&#34;UPDATE mensajes SET isread=1 WHERE ID = </span><span style="color:#a31515">$id</span><span style="color:#a31515">&#34;</span>);
            <span style="color:#00f">return</span> $datosmensaje;
        }
    
    }
    
    <span style="color:#008000">//borra de la bandeja de entrada el mensaje con id pasado por parametro
</span><span style="color:#008000"></span>    <span style="color:#00f">public</span> <span style="color:#00f">function</span> borrarrecibido ($id){
        <span style="color:#00f">if</span>(<span style="color:#00f">empty</span>($id)){
            <span style="color:#00f">return</span> <span style="color:#a31515">&#39;Debe Pasar Como Parametro Un ID De Mensaje Para Borrar&#39;</span>;
        }<span style="color:#00f">else</span>{
            $borrarrecibido = mysql_query(<span style="color:#a31515">&#34;UPDATE mensajes SET deleteto=1 WHERE ID=</span><span style="color:#a31515">$id</span><span style="color:#a31515">&#34;</span>);
            <span style="color:#00f">if</span>($borrarrecibido){
                <span style="color:#00f">return</span> <span style="color:#00f">true</span>;
            }<span style="color:#00f">else</span>{
                <span style="color:#00f">return</span> <span style="color:#00f">false</span>;
            }
        }    
    }
    
    <span style="color:#008000">//borra de la bandeja de salida el mensaje con id pasado por parametro
</span><span style="color:#008000"></span>    <span style="color:#00f">public</span> <span style="color:#00f">function</span> borrarenviado ($id){
        <span style="color:#00f">if</span>(<span style="color:#00f">empty</span>($id)){
            <span style="color:#00f">return</span> <span style="color:#a31515">&#39;Debe Pasar Como Parametro Un ID De Mensaje Para Borrar&#39;</span>;
        }<span style="color:#00f">else</span>{
            $borrarenviado = mysql_query(<span style="color:#a31515">&#34;UPDATE mensajes SET deletefrom=1 WHERE ID=</span><span style="color:#a31515">$id</span><span style="color:#a31515">&#34;</span>);
            <span style="color:#00f">if</span>($borrarenviado){
                <span style="color:#00f">return</span> <span style="color:#00f">true</span>;
            }<span style="color:#00f">else</span>{
                <span style="color:#00f">return</span> <span style="color:#00f">false</span>;
            }
        }    
    }    

}
<span style="color:#00f">?&gt;</span>
</code></pre></div>
<p>y se usa de la siguiente manera..</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#00f">&lt;?php</span>
<span style="color:#008000">//creamos una nueva instancia de la clase
</span><span style="color:#008000"></span>$mensjaes = <span style="color:#00f">new</span> mensajeria(<span style="color:#a31515">&#39;ACA NOMBRE DE LA BASE&#39;</span>);

<span style="color:#008000">//para enviar mensaje, pasando parametros
</span><span style="color:#008000"></span>$mensjaes-&gt;enviar(<span style="color:#a31515">&#39;DE&#39;</span>,<span style="color:#a31515">&#39;PARA&#39;</span>,<span style="color:#a31515">&#39;ASUNTO&#39;</span>,<span style="color:#a31515">&#39;MENSAJE&#39;</span>);

<span style="color:#008000">//devuelve un array con los mensajes recibidos del user pasado como parametro
</span><span style="color:#008000"></span>$mensjaes-&gt;obtenerrecibidos(<span style="color:#a31515">&#39;USER&#39;</span>);

<span style="color:#008000">//devuelve un array con los mensajes enviados del user pasado como parametro
</span><span style="color:#008000"></span>$mensjaes-&gt;obtenerenviados(<span style="color:#a31515">&#39;USER&#39;</span>);

<span style="color:#008000">//devuelve un array con los datos del mensaje pasado como parametro a traves de su ID 
</span><span style="color:#008000"></span>$mensjaes-&gt;ver(<span style="color:#a31515">&#39;ID&#39;</span>);

<span style="color:#008000">//borra de la baneja de enrtada el mensaje pasado como parametro a traves de su ID
</span><span style="color:#008000"></span>$mensjaes-&gt;borrarrecibido(<span style="color:#a31515">&#39;ID&#39;</span>);

<span style="color:#008000">//borra de la baneja de salida el mensaje pasado como parametro a traves de su ID
</span><span style="color:#008000"></span>$mensjaes-&gt;borrarenviado(<span style="color:#a31515">&#39;ID&#39;</span>);
<span style="color:#00f">?&gt;</span>
</code></pre></div>
<p>PD OLVIDADA : Lo Realize En POO Para Ir Practicando Ademas Al Tener Que Realizar Un Cambio, Lo Haces En La Clase, Y Listo, Cambias Absolutamente Casi Todo El Sitio</p>

</section>
</article>
</body>
</html>
